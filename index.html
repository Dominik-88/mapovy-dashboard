<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vod√°rensk√© are√°ly - Management syst√©m</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" 
          crossorigin=""/>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
        #map { height: 100vh; width: 100%; }
        .top-bar { position: fixed; top: 0; left: 0; right: 0; background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%); color: white; padding: 12px 15px; z-index: 1001; box-shadow: 0 2px 10px rgba(0,0,0,0.3); display: flex; justify-content: space-between; align-items: center; }
        .top-bar h1 { font-size: 16px; font-weight: 700; }
        .top-bar-btn { padding: 8px 14px; background: rgba(255,255,255,0.25); border: 1px solid rgba(255,255,255,0.3); color: white; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600; margin-left: 8px; }
        .controls { position: fixed; top: 60px; right: 10px; z-index: 1000; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); max-width: 340px; max-height: calc(100vh - 80px); overflow-y: auto; }
        .control-section { margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #e2e8f0; }
        .control-section:last-child { border-bottom: none; margin-bottom: 0; }
        .section-title { font-size: 13px; font-weight: 700; color: #1e293b; margin-bottom: 10px; }
        .control-group { margin-bottom: 10px; }
        .control-group:last-child { margin-bottom: 0; }
        label { display: block; font-weight: 600; margin-bottom: 5px; font-size: 11px; color: #475569; }
        select, input, button { width: 100%; padding: 8px; border: 1px solid #e2e8f0; border-radius: 5px; font-size: 12px; }
        button { background: #3b82f6; color: white; font-weight: 600; cursor: pointer; border: none; }
        button:active { background: #2563eb; }
        .btn-success { background: #10b981; }
        .btn-success:active { background: #059669; }
        .btn-danger { background: #ef4444; }
        .btn-danger:active { background: #dc2626; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .stat-card { background: #f8fafc; padding: 10px; border-radius: 6px; border: 1px solid #e2e8f0; text-align: center; }
        .stat-card.warning { background: #fef3c7; border-color: #fbbf24; }
        .stat-card.danger { background: #fee2e2; border-color: #ef4444; }
        .stat-value { font-size: 18px; font-weight: 700; color: #1e293b; }
        .stat-label { font-size: 10px; color: #64748b; margin-top: 2px; }
        .legend { background: white; padding: 10px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.15); }
        .legend-title { font-weight: 700; margin-bottom: 8px; font-size: 12px; }
        .legend-item { display: flex; align-items: center; margin-bottom: 6px; font-size: 11px; }
        .legend-color { width: 18px; height: 18px; border-radius: 50%; margin-right: 8px; border: 2px solid white; box-shadow: 0 2px 6px rgba(0,0,0,0.3); }
        @media (max-width: 768px) {
            .top-bar h1 { font-size: 14px; }
            .controls { max-width: calc(100vw - 20px); }
        }
    </style>
</head>
<body>
    <div class="top-bar">
        <h1>üö∞ Vod√°rensk√© are√°ly</h1>
        <div>
            <button class="top-bar-btn" onclick="exportCSV()">üì• Export</button>
        </div>
    </div>
    
    <div id="map"></div>
    
    <div class="controls">
        <div class="control-section">
            <div class="section-title">üîç Filtry</div>
            <div class="control-group">
                <label>Vyhledat</label>
                <input type="text" id="search" placeholder="N√°zev..." oninput="applyFilters()">
            </div>
            <div class="control-group">
                <label>Okres</label>
                <select id="okres" onchange="applyFilters()">
                    <option value="all">V≈°echny</option>
                    <option value="CB">ƒåesk√© Budƒõjovice</option>
                    <option value="TA">T√°bor</option>
                    <option value="CK">ƒåesk√Ω Krumlov</option>
                    <option value="PT">Prachatice</option>
                    <option value="PI">P√≠sek</option>
                    <option value="ST">Strakonice</option>
                </select>
            </div>
            <div class="control-group">
                <label>Kategorie</label>
                <select id="kategorie" onchange="applyFilters()">
                    <option value="all">V≈°echny</option>
                    <option value="I.">Kategorie I</option>
                    <option value="II.">Kategorie II</option>
                    <option value="">Bez kategorie</option>
                </select>
            </div>
            <div class="control-group">
                <label>Zabezpeƒçen√≠</label>
                <select id="zabezpeceni" onchange="applyFilters()">
                    <option value="all">V≈°echny</option>
                    <option value="dobr√Ω">Dobr√Ω stav</option>
                    <option value="rizikov√Ω">Rizikov√Ω</option>
                    <option value="havarijn√≠">Havarijn√≠</option>
                </select>
            </div>
        </div>
        
        <div class="control-section">
            <div class="section-title">üìä Statistiky</div>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="count">41</div>
                    <div class="stat-label">Are√°l≈Ø</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="area">198k</div>
                    <div class="stat-label">m¬≤</div>
                </div>
                <div class="stat-card warning">
                    <div class="stat-value" id="risky">3</div>
                    <div class="stat-label">üö® Rizikov√©</div>
                </div>
                <div class="stat-card danger">
                    <div class="stat-value" id="critical">2</div>
                    <div class="stat-label">üü• Havarijn√≠</div>
                </div>
            </div>
        </div>
        
        <div class="control-section">
            <button onclick="resetView()">üîÑ Reset pohledu</button>
            <button class="btn-success" style="margin-top:8px" onclick="showAll()">üëÅÔ∏è Zobrazit v≈°e</button>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" 
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" 
            crossorigin=""></script>
    <script>
        const data = [
            {n:"VDJ Amerika II",o:"PI",k:"I.",s:"dobr√Ω",op:293,v:3303,lat:49.305131,lon:14.166126},
            {n:"VDJ Drahonice",o:"ST",k:"I.",s:"dobr√Ω",op:376,v:5953,lat:49.202902,lon:14.063713},
            {n:"VDJ Vod≈àany",o:"ST",k:"I.",s:"dobr√Ω",op:252,v:1594,lat:49.147778,lon:14.175278},
            {n:"VDJ Hlavatce",o:"CB",k:"",s:"rizikov√Ω",op:424,v:7968,lat:49.063584,lon:14.267751},
            {n:"VDJ ≈†ibeniƒçn√≠ vrch I",o:"PT",k:"I.",s:"dobr√Ω",op:245,v:1835,lat:49.013333,lon:13.994444},
            {n:"√öV Husinecka p≈ôehrada",o:"PT",k:"",s:"dobr√Ω",op:703,v:4908,lat:49.058889,lon:13.994722},
            {n:"VDJ ≈†ibeniƒçn√≠ vrch II",o:"PT",k:"I.",s:"dobr√Ω",op:340,v:3206,lat:49.02671,lon:13.994001},
            {n:"VDJ Z√°lu≈æany",o:"PI",k:"",s:"dobr√Ω",op:299,v:2350,lat:49.316389,lon:14.096111},
            {n:"VDJ Pt√°ƒçn√≠k",o:"PT",k:"II.",s:"dobr√Ω",op:239,v:1070,lat:49.091111,lon:13.948056},
            {n:"VDJ Zdoba",o:"CB",k:"II.",s:"havarijn√≠",op:225,v:15523,lat:49.212422,lon:14.338095},
            {n:"VDJ Domoradice",o:"CK",k:"I.",s:"dobr√Ω",op:450,v:4148,lat:48.812778,lon:14.273056},
            {n:"VDJ Horn√≠ Br√°na",o:"CK",k:"I.",s:"dobr√Ω",op:187,v:1665,lat:48.80797,lon:14.329352},
            {n:"VDJ Net≈ôebice",o:"CK",k:"I.",s:"dobr√Ω",op:136,v:877,lat:48.856389,lon:14.318611},
            {n:"VDJ Ple≈°ivec",o:"CK",k:"I.",s:"dobr√Ω",op:119,v:975,lat:48.823056,lon:14.165278},
            {n:"VDJ Doudleby",o:"CB",k:"II.",s:"dobr√Ω",op:79,v:413,lat:48.991944,lon:14.505556},
            {n:"VDJ Jankov",o:"CB",k:"I.",s:"dobr√Ω",op:106,v:784,lat:49.033566,lon:14.492817},
            {n:"VDJ Hos√≠n II",o:"CB",k:"I.",s:"rizikov√Ω",op:399,v:4173,lat:49.016111,lon:14.452778},
            {n:"VDJ Chlum",o:"CB",k:"II.",s:"dobr√Ω",op:63,v:535,lat:49.091944,lon:14.534167},
            {n:"VDJ Chot√Ωƒçany",o:"CB",k:"II.",s:"dobr√Ω",op:338,v:4775,lat:49.133611,lon:14.498889},
            {n:"VDJ Rudolfov III",o:"CB",k:"I.",s:"dobr√Ω",op:174,v:1868,lat:48.988889,lon:14.595833},
            {n:"VDJ Rimov - Vesce",o:"CB",k:"I.",s:"dobr√Ω",op:99,v:662,lat:48.842778,lon:14.525},
            {n:"VDJ Hosin",o:"CB",k:"II.",s:"dobr√Ω",op:125,v:809,lat:49.013889,lon:14.450278},
            {n:"VDJ Vƒçeln√°",o:"CB",k:"II.",s:"dobr√Ω",op:476,v:8660,lat:48.966389,lon:14.454722},
            {n:"VDJ H√∫ry",o:"CB",k:"I.",s:"havarijn√≠",op:0,v:395,lat:49.058611,lon:14.481944},
            {n:"VDJ Chlumec",o:"CB",k:"II.",s:"dobr√Ω",op:110,v:811,lat:49.054167,lon:14.488889},
            {n:"VDJ Ole≈°n√≠k",o:"CB",k:"I.",s:"dobr√Ω",op:117,v:380,lat:49.056944,lon:14.498611},
            {n:"ƒåS Bukovec",o:"CB",k:"I.",s:"dobr√Ω",op:300,v:4943,lat:48.949167,lon:14.480833},
            {n:"VDJ He≈ôman",o:"CB",k:"II.",s:"dobr√Ω",op:119,v:982,lat:48.991667,lon:14.535},
            {n:"ƒåS Vidov u ≈ôeky",o:"CB",k:"II.",s:"dobr√Ω",op:212,v:2501,lat:48.950833,lon:14.479722},
            {n:"Vrt Vidov",o:"CB",k:"II.",s:"dobr√Ω",op:164,v:470,lat:48.951111,lon:14.480556},
            {n:"√öV Plav",o:"CB",k:"I.",s:"dobr√Ω",op:1413,v:74777,lat:49.006111,lon:14.452778},
            {n:"VDJ ƒåekanice",o:"TA",k:"I.",s:"dobr√Ω",op:450,v:6344,lat:49.422197,lon:14.689896},
            {n:"VDJ Svat√° Anna",o:"TA",k:"I.",s:"dobr√Ω",op:264,v:4192,lat:49.401133,lon:14.69864},
            {n:"VDJ Bezdƒõƒç√≠n",o:"TA",k:"I.",s:"dobr√Ω",op:169,v:1996,lat:49.381667,lon:14.700556},
            {n:"VDJ Milevsko",o:"TA",k:"I.",s:"rizikov√Ω",op:129,v:823,lat:49.452521,lon:14.344102},
            {n:"VDJ Hodu≈°√≠n",o:"TA",k:"II.",s:"dobr√Ω",op:205,v:1708,lat:49.42967,lon:14.474214},
            {n:"VDJ V≈°echov",o:"TA",k:"I.",s:"dobr√Ω",op:199,v:1574,lat:49.430159,lon:14.623205},
            {n:"VDJ Zlukov",o:"TA",k:"II.",s:"dobr√Ω",op:184,v:1520,lat:49.196289,lon:14.736382},
            {n:"√öV T√°bor",o:"TA",k:"II.",s:"dobr√Ω",op:350,v:12262,lat:49.422872,lon:14.666426},
            {n:"ƒåS Sudomƒõ≈ôice",o:"TA",k:"I.",s:"dobr√Ω",op:220,v:2508,lat:49.368611,lon:14.720278},
            {n:"Provozn√≠ Vodojem T√°bor",o:"TA",k:"II.",s:"dobr√Ω",op:155,v:1853,lat:49.413889,lon:14.659167}
        ];

        let map, markers = [];

        function init() {
            if (typeof L === 'undefined') {
                setTimeout(init, 100);
                return;
            }
            
            map = L.map('map').setView([49.15, 14.35], 10);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap',
                maxZoom: 19
            }).addTo(map);

            const legend = L.control({position: 'bottomleft'});
            legend.onAdd = function() {
                const div = L.DomUtil.create('div', 'legend');
                div.innerHTML = `
                    <div class="legend-title">Legenda</div>
                    <div class="legend-item">
                        <div class="legend-color" style="background:#dc2626"></div>
                        Kategorie I
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background:#f97316"></div>
                        Kategorie II
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background:#64748b"></div>
                        Bez kategorie
                    </div>
                `;
                return div;
            };
            legend.addTo(map);

            createMarkers(data);
        }

        function createMarkers(filtered) {
            markers.forEach(m => map.removeLayer(m));
            markers = [];

            filtered.forEach(d => {
                const color = d.k === 'I.' ? '#dc2626' : d.k === 'II.' ? '#f97316' : '#64748b';
                const icon = L.divIcon({
                    html: `<div style="background:${color};width:24px;height:24px;border-radius:50%;border:3px solid white;box-shadow:0 2px 8px rgba(0,0,0,0.3)"></div>`,
                    iconSize: [24, 24],
                    className: ''
                });

                const m = L.marker([d.lat, d.lon], {icon}).addTo(map);
                const sc = d.s === 'havarijn√≠' ? 'danger' : d.s === 'rizikov√Ω' ? 'warning' : 'success';
                
                m.bindPopup(`
                    <div style="font-family:system-ui;padding:10px;min-width:220px">
                        <div style="font-size:15px;font-weight:700;margin-bottom:10px;padding-bottom:8px;border-bottom:2px solid #3b82f6">${d.n}</div>
                        <div style="display:flex;justify-content:space-between;padding:5px 0;font-size:12px;border-bottom:1px solid #f1f5f9">
                            <span style="color:#64748b">Okres:</span>
                            <span style="font-weight:700">${d.o}</span>
                        </div>
                        <div style="display:flex;justify-content:space-between;padding:5px 0;font-size:12px;border-bottom:1px solid #f1f5f9">
                            <span style="color:#64748b">Kategorie:</span>
                            <span style="font-weight:700">${d.k || 'Bez'}</span>
                        </div>
                        <div style="display:flex;justify-content:space-between;padding:5px 0;font-size:12px;border-bottom:1px solid #f1f5f9">
                            <span style="color:#64748b">Zabezpeƒçen√≠:</span>
                            <span style="font-weight:700;color:${sc==='danger'?'#dc2626':sc==='warning'?'#d97706':'#059669'}">${d.s}</span>
                        </div>
                        <div style="display:flex;justify-content:space-between;padding:5px 0;font-size:12px;border-bottom:1px solid #f1f5f9">
                            <span style="color:#64748b">V√Ωmƒõra:</span>
                            <span style="font-weight:700">${d.v.toLocaleString()} m¬≤</span>
                        </div>
                        <div style="display:flex;justify-content:space-between;padding:5px 0;font-size:12px">
                            <span style="color:#64748b">Oplocen√≠:</span>
                            <span style="font-weight:700">${d.op.toLocaleString()} bm</span>
                        </div>
                        <a href="https://www.google.com/maps/dir/?api=1&destination=${d.lat},${d.lon}" target="_blank" style="display:block;text-align:center;padding:10px;background:#3b82f6;color:white;text-decoration:none;border-radius:6px;font-size:12px;font-weight:600;margin-top:10px">
                            üß≠ Navigovat
                        </a>
                    </div>
                `);
                
                markers.push(m);
            });

            updateStats(filtered);
        }

        function updateStats(filtered) {
            document.getElementById('count').textContent = filtered.length;
            const area = filtered.reduce((s, d) => s + d.v, 0);
            document.getElementById('area').textContent = (area / 1000).toFixed(0) + 'k';
            document.getElementById('risky').textContent = filtered.filter(d => d.s === 'rizikov√Ω').length;
            document.getElementById('critical').textContent = filtered.filter(d => d.s === 'havarijn√≠').length;
        }

        function applyFilters() {
            const search = document.getElementById('search').value.toLowerCase();
            const okres = document.getElementById('okres').value;
            const kat = document.getElementById('kategorie').value;
            const zab = document.getElementById('zabezpeceni').value;

            let filtered = data;
            if (search) filtered = filtered.filter(d => d.n.toLowerCase().includes(search));
            if (okres !== 'all') filtered = filtered.filter(d => d.o === okres);
            if (kat !== 'all') filtered = filtered.filter(d => d.k === kat);
            if (zab !== 'all') filtered = filtered.filter(d => d.s === zab);

            createMarkers(filtered);
        }

        function resetView() {
            map.setView([49.15, 14.35], 10);
        }

        function showAll() {
            document.getElementById('search').value = '';
            document.getElementById('okres').value = 'all';
            document.getElementById('kategorie').value = 'all';
            document.getElementById('zabezpeceni').value = 'all';
            applyFilters();
        }

        function exportCSV() {
            const csv = [
                'Nazev;Okres;Kategorie;Zabezpeceni;Vymera_m2;Oploceni_bm;GPS_Lat;GPS_Lon',
                ...data.map(d => `"${d.n}";${d.o};${d.k||'Bez'};${d.s};${d.v};${d.op};${d.lat};${d.lon}`)
            ].join('\n');
            
            const blob = new Blob(['\uFEFF' + csv], {type: 'text/csv;charset=utf-8'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'vodovody_export.csv';
            a.click();
            URL.revokeObjectURL(url);
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
