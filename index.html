<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vod√°rensk√© are√°ly ‚Äì Kompletn√≠ management syst√©m</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css">
<style>
/* Z√°kladn√≠ reset a glob√°ln√≠ styl */
*{box-sizing:border-box}
body{margin:0;font-family:Inter,system-ui;background:#f1f5f9;color:#0f172a}

/* Mapa p≈ôes celou v√Ω≈°ku okna */
#map{height:100vh}

/* Horn√≠ li≈°ta aplikace */
.top{position:fixed;top:0;left:0;right:0;z-index:1000;background:linear-gradient(135deg,#1e3a8a,#2563eb);color:#fff;padding:10px 14px;display:flex;justify-content:space-between;align-items:center}
.top h1{margin:0;font-size:15px;font-weight:700}
.top small{opacity:.85;font-size:11px}

/* Tlaƒç√≠tka v horn√≠ li≈°tƒõ */
.btn-top{background:#ffffff22;color:#fff;border:1px solid #ffffff44;border-radius:6px;padding:6px 10px;font-size:12px;font-weight:600;cursor:pointer}

/* Prav√Ω ovl√°dac√≠ panel */
.panel{position:fixed;top:56px;right:10px;z-index:1000;width:380px;max-height:calc(100vh - 70px);background:#fff;border-radius:12px;box-shadow:0 20px 40px rgba(0,0,0,.25);overflow:auto;padding:14px}

/* Jednotliv√© sekce panelu */
.section{border-bottom:1px solid #e5e7eb;margin-bottom:14px;padding-bottom:14px}
.section:last-child{border:none;margin:0}
.section h2{margin:0 0 8px;font-size:13px}

/* Formul√°≈ôov√© prvky */
label{font-size:11px;font-weight:700;color:#475569}
input,select,button{width:100%;margin-top:4px;padding:8px;border-radius:6px;border:1px solid #e5e7eb;font-size:12px}
button{cursor:pointer}

/* Styl prim√°rn√≠ch akc√≠ */
.primary{background:#2563eb;color:#fff;border:none;font-weight:700}
.success{background:#10b981;color:#fff;border:none;font-weight:700}

/* Grid pro statistick√© karty */
.grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.card{background:#f8fafc;border:1px solid #e5e7eb;border-radius:10px;padding:8px;text-align:center}
.card .v{font-size:18px;font-weight:800}
.card .l{font-size:10px;color:#64748b}

/* Tabulka evidence */
.table{width:100%;border-collapse:collapse;font-size:11px}
.table th,.table td{border-bottom:1px solid #e5e7eb;padding:6px}
.small{font-size:10px;color:#64748b}
</style>
</head>
<body>

<!-- Horn√≠ informaƒçn√≠ li≈°ta -->
<div class="top">
  <div>
    <h1>¬§¬§¬§ JVS are√°ly ¬§¬§¬§ by Dominik Schmied</h1>
    <small>01/2025 aktualizace</small>
  </div>
  <div>
    <button class="btn-top" onclick="exportCSV()">üì§ Export CSV</button>
  </div>
</div>

<!-- Kontejner mapy -->
<div id="map"></div>

<!-- Ovl√°dac√≠ panel -->
<div class="panel">

<div class="section">
<h2>üîç Filtry objekt≈Ø</h2>
<label>N√°zev</label><input id="fName" oninput="applyFilters()">
<label>Okres</label><select id="fOkres" onchange="applyFilters()"><option value="all">V≈°echny</option></select>
<label>Stav</label><select id="fStav" onchange="applyFilters()"><option value="all">V≈°echny</option><option>dobr√Ω</option><option>rizikov√Ω</option><option>havarijn√≠</option></select>
</div>

<div class="section">
<h2>üìä Statistiky</h2>
<div class="grid">
<div class="card"><div class="v" id="stObj">0</div><div class="l">Objekt≈Ø</div></div>
<div class="card"><div class="v" id="stArea">0</div><div class="l">Posek√°no m¬≤</div></div>
<div class="card"><div class="v" id="stKm">0</div><div class="l">Ujeto km</div></div>
<div class="card"><div class="v" id="stCash">0 Kƒç</div><div class="l">Zisk</div></div>
</div>
</div>

<div class="section">
<h2>üë∑ Denn√≠ v√Ωkon</h2>
<label>Zamƒõstnanec</label><input id="empName">
<label>Objekt</label><select id="empObj"></select>
<label>Odpracov√°no (h)</label><input id="empHours" type="number">
<label>Posek√°no (m¬≤)</label><input id="empArea" type="number">
<label>Ujeto (km)</label><input id="empKm" type="number">
<button class="success" onclick="saveWork()">Ulo≈æit v√Ωkon</button>
</div>

<div class="section">
<h2>üí∞ Finance</h2>
<label>P≈ô√≠jem (Kƒç)</label><input id="finIn" type="number">
<label>N√°klad (Kƒç)</label><input id="finOut" type="number">
<button class="primary" onclick="saveFinance()">Ulo≈æit finance</button>
<div class="small">Automatick√Ω v√Ωpoƒçet zisku</div>
</div>

<div class="section">
<h2>üìã Evidence</h2>
<table class="table"><tbody id="logTable"></tbody></table>
</div>
</div>

<!-- Leaflet knihovny -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>

<script>
// Spu≈°tƒõn√≠ aplikace
console.log('Inicializace aplikace');

// Datov√Ω model vod√°rensk√Ωch objekt≈Ø
const objects=[
 {o:"PI",n:"VDJ Amerika II",k:"I.",bm:293,v:3303,lat:49.305131,lon:14.166126},
 {o:"ST",n:"VDJ Drahonice",k:"I.",bm:376,v:5953,lat:49.202902,lon:14.063713},
 {o:"ST",n:"VDJ Vod≈àany",k:"I.",bm:252,v:1594,lat:49.16455,lon:14.177836},
 {o:"CB",n:"VDJ Hlavatce",k:"",bm:424,v:7968,lat:49.063584,lon:14.267751},
 {o:"PT",n:"VDJ ≈†ibeniƒçn√≠ vrch I",k:"I.",bm:245,v:1835,lat:49.025083,lon:13.994111},
 {o:"PT",n:"√öV Husinecka p≈ôehrada",k:"",bm:703,v:4908,lat:49.034362,lon:13.99683},
 {o:"PT",n:"VDJ ≈†ibeniƒçn√≠ vrch II",k:"I.",bm:340,v:3206,lat:49.02671,lon:13.994001},
 {o:"PI",n:"VDJ Z√°lu≈æany",k:"",bm:299,v:2350,lat:49.552857,lon:14.083381},
 {o:"PT",n:"VDJ Pt√°ƒçn√≠k",k:"II.",bm:239,v:1070,lat:49.066147,lon:14.186844},
 {o:"CB",n:"VDJ Zdoba",k:"II.",bm:225,v:15523,lat:49.212422,lon:14.338095},
 {o:"CK",n:"VDJ Domoradice",k:"I.",bm:450,v:4148,lat:48.829651,lon:14.326564},
 {o:"CK",n:"VDJ Horn√≠ Br√°na",k:"I.",bm:187,v:1665,lat:48.80797,lon:14.329352},
 {o:"CK",n:"VDJ Net≈ôebice",k:"I.",bm:136,v:877,lat:48.783277,lon:14.456447},
 {o:"CK",n:"VDJ Ple≈°ivec",k:"I.",bm:119,v:975,lat:48.802231,lon:14.304933},
 {o:"CB",n:"VDJ Doudleby",k:"II.",bm:79,v:413,lat:48.888896,lon:14.480271},
 {o:"CB",n:"VDJ Jankov",k:"I.",bm:106,v:784,lat:48.968747,lon:14.301697},
 {o:"CB",n:"VDJ Hos√≠n II",k:"I.",bm:399,v:4173,lat:49.030641,lon:14.501012},
 {o:"CB",n:"VDJ Chlum",k:"II.",bm:63,v:535,lat:49.096493,lon:14.388679},
 {o:"CB",n:"VDJ Chot√Ωƒçany",k:"II.",bm:338,v:4775,lat:49.070748,lon:14.51946},
 {o:"CB",n:"VDJ Rudolfov III",k:"I.",bm:174,v:1868,lat:48.986207,lon:14.547076},
 {o:"CB",n:"VDJ Rimov - Vesce",k:"I.",bm:99,v:662,lat:48.847847,lon:14.466957},
 {o:"CB",n:"VDJ Hosin",k:"II.",bm:125,v:809,lat:49.013889,lon:14.450278},
 {o:"CB",n:"VDJ Vƒçeln√°",k:"II.",bm:476,v:8660,lat:48.966389,lon:14.454722},
 {o:"CB",n:"VDJ H√∫ry",k:"I.",bm:0,v:395,lat:49.058611,lon:14.481944},
 {o:"CB",n:"VDJ Chlumec",k:"II.",bm:110,v:811,lat:49.124766,lon:14.431321},
 {o:"CB",n:"VDJ Ole≈°n√≠k",k:"I.",bm:117,v:380,lat:49.111103,lon:14.377766},
 {o:"CB",n:"ƒåS Bukovec",k:"I.",bm:300,v:4943,lat:48.881608,lon:14.449233},
 {o:"CB",n:"VDJ He≈ôman",k:"II.",bm:119,v:982,lat:48.909479,lon:14.499876},
 {o:"CB",n:"ƒåS Vidov u ≈ôeky",k:"II.",bm:212,v:2501,lat:48.950833,lon:14.479722},
 {o:"CB",n:"Vrt Vidov",k:"II.",bm:164,v:470,lat:48.924066,lon:14.489679},
 {o:"CB",n:"√öV Plav",k:"I.",bm:1413,v:74777,lat:48.912611,lon:14.494018},
 {o:"TA",n:"VDJ ƒåekanice",k:"I.",bm:450,v:6344,lat:49.422197,lon:14.689896},
 {o:"TA",n:"VDJ Svat√° Anna",k:"I.",bm:264,v:4192,lat:49.401133,lon:14.69864},
 {o:"TA",n:"VDJ Bezdƒõƒç√≠n",k:"I.",bm:169,v:1996,lat:49.323096,lon:14.628405},
 {o:"TA",n:"VDJ Milevsko",k:"I.",bm:129,v:823,lat:49.452521,lon:14.344102},
 {o:"TA",n:"VDJ Hodu≈°√≠n",k:"II.",bm:205,v:1708,lat:49.42967,lon:14.474214},
 {o:"TA",n:"VDJ V≈°echov",k:"I.",bm:199,v:1574,lat:49.430159,lon:14.623205},
 {o:"TA",n:"VDJ Zlukov",k:"II.",bm:184,v:1520,lat:49.196289,lon:14.736382},
 {o:"TA",n:"√öV T√°bor",k:"II.",bm:350,v:12262,lat:49.422872,lon:14.666426},
 {o:"TA",n:"ƒåS Sudomƒõ≈ôice",k:"I.",bm:220,v:2508,lat:49.28658,lon:14.547794},
 {o:"TA",n:"Provozn√≠ Vodojem T√°bor",k:"II.",bm:155,v:1853,lat:49.424264,lon:14.666384}
];

// Pracovn√≠ kopie dat po aplikaci filtr≈Ø
let filtered=[...objects];
console.log('Naƒçteno objekt≈Ø:', objects.length);

// Inicializace mapy a z√°kladn√≠ho pohledu
const map=L.map('map').setView([49.1,14.4],9);
console.log('Mapa inicializov√°na');

// Podkladov√° OpenStreetMap vrstva
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);

// Skupina pro kreslen√© objekty (mƒõ≈ôen√≠)
const drawn=new L.FeatureGroup();
map.addLayer(drawn);

// Ovl√°d√°n√≠ kreslen√≠ vzd√°lenost√≠ a ploch
map.addControl(new L.Control.Draw({
 draw:{polygon:true,polyline:true,rectangle:false,circle:false,marker:false},
 edit:{featureGroup:drawn}
}));

// Reakce na dokonƒçen√≠ kreslen√≠
map.on(L.Draw.Event.CREATED,e=>{
 console.log('Vykreslen nov√Ω prvek');
 drawn.addLayer(e.layer)
});

// Reference na vykreslen√© markery
let markers=[];

// Vykreslen√≠ objekt≈Ø na mapu
function render(){
 console.log('Render objekt≈Ø:', filtered.length);
 markers.forEach(m=>map.removeLayer(m));
 markers=[];
 filtered.forEach(d=>{
  const c=d.s==='havarijn√≠'?'#dc2626':d.s==='rizikov√Ω'?'#f59e0b':'#16a34a';
  const m=L.circleMarker([d.lat,d.lon],{radius:8,color:c,fillOpacity:.9})
   .addTo(map)
   .bindPopup(`<b>${d.n}</b><br>Okres: ${d.o}<br>Stav: ${d.s}<br>Plocha: ${d.v.toLocaleString()} m¬≤`);
  markers.push(m)
 });
 updateStats()
}

// Aplikace filtr≈Ø z UI
function applyFilters(){
 const n=fName.value.toLowerCase();
 const o=fOkres.value;
 const s=fStav.value;
 filtered=objects.filter(d=>(!n||d.n.toLowerCase().includes(n))&&(o==='all'||d.o===o)&&(s==='all'||d.s===s));
 console.log('Aplikov√°ny filtry', {n,o,s,results:filtered.length});
 render()
}

// P≈ôepoƒçet a zobrazen√≠ statistik
function updateStats(){
 stObj.textContent=filtered.length;
 stArea.textContent=(+localStorage.area||0).toLocaleString();
 stKm.textContent=(+localStorage.km||0).toLocaleString();
 stCash.textContent=(+localStorage.cash||0).toLocaleString()+" Kƒç";
 console.log('Statistiky aktualizov√°ny')
}

// Ulo≈æen√≠ denn√≠ho v√Ωkonu zamƒõstnance
function saveWork(){
 console.log('Ukl√°d√°m v√Ωkon', {emp:empName.value,area:empArea.value,km:empKm.value});
 localStorage.area=(+localStorage.area||0)+(+empArea.value||0);
 localStorage.km=(+localStorage.km||0)+(+empKm.value||0);
 appendLog(`V√Ωkon: ${empName.value} ‚Äì ${empArea.value} m¬≤, ${empKm.value} km`);
 render()
}

// Ulo≈æen√≠ finanƒçn√≠ho z√°znamu
function saveFinance(){
 const z=(+finIn.value||0)-(+finOut.value||0);
 console.log('Ukl√°d√°m finance', {in:finIn.value,out:finOut.value,profit:z});
 localStorage.cash=(+localStorage.cash||0)+z;
 appendLog(`Finance: zisk ${z.toLocaleString()} Kƒç`);
 render()
}

// P≈ôid√°n√≠ z√°znamu do evidence
function appendLog(t){
 console.log('Z√°znam logu:', t);
 const tb=document.getElementById('logTable');
 tb.innerHTML=`<tr><td>${new Date().toLocaleString()}</td><td>${t}</td></tr>`+tb.innerHTML
}

// Export seznamu objekt≈Ø do CSV
function exportCSV(){
 console.log('Export CSV');
 const rows=['Nazev;Okres;Stav;Lat;Lon;Plocha_m2'];
 objects.forEach(d=>rows.push(`${d.n};${d.o};${d.s};${d.lat};${d.lon};${d.v}`));
 const blob=new Blob(['\uFEFF'+rows.join('\n')],{type:'text/csv'});
 const a=document.createElement('a');
 a.href=URL.createObjectURL(blob);
 a.download='vodarenske_arealy.csv';
 a.click()
}

// Naplnƒõn√≠ filtr≈Ø a v√Ωbƒõr≈Ø daty
[...new Set(objects.map(o=>o.o))].forEach(o=>{
 console.log('P≈ôid√°n okres do filtru:',o);
 fOkres.innerHTML+=`<option>${o}</option>`
});

objects.forEach(o=>{
 console.log('P≈ôid√°n objekt do v√Ωbƒõru:',o.n);
 empObj.innerHTML+=`<option>${o.n}</option>`
});

// Prvn√≠ vykreslen√≠ aplikace
render();
</script>
</body>
</html>

