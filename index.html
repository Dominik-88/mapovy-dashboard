<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <title>Mapový Dashboard – Vodárenské areály</title>

  <!-- Viewport -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />

  <!-- Tailwind CSS (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- PWA placeholder -->
  <link rel="manifest" href="manifest.json" />

  <style>
    html, body {
      height: 100%;
      margin: 0;
    }
    #map {
      height: 100%;
      width: 100%;
    }
  </style>
</head>

<body class="h-full flex flex-col">

<!-- ===================== -->
<!-- HEADER -->
<!-- ===================== -->
<header class="bg-slate-800 text-white px-4 py-3 flex items-center justify-between">
  <div class="font-semibold text-sm sm:text-base">
    Mapový Dashboard – Vodárenské areály
  </div>
  <div id="statusBar" class="text-xs text-slate-300">
    Načítám data…
  </div>
</header>

<!-- ===================== -->
<!-- MAIN LAYOUT -->
<!-- ===================== -->
<div class="flex flex-1 overflow-hidden">

  <!-- SIDE PANEL -->
  <!-- SIDE PANEL -->
<aside class="hidden sm:flex w-80 bg-slate-100 border-r border-slate-200 flex-col">

  <!-- Filtry -->
  <div class="p-4 border-b">
    <div class="font-semibold mb-3">Filtry</div>

    <input id="filterText"
      type="text"
      placeholder="Název / okres"
      class="w-full mb-2 px-2 py-1 text-sm border rounded" />

    <select id="filterOkres"
      class="w-full mb-2 px-2 py-1 text-sm border rounded">
      <option value="">Všechny okresy</option>
    </select>

    <select id="filterKategorie"
      class="w-full mb-2 px-2 py-1 text-sm border rounded">
      <option value="">Všechny kategorie</option>
      <option value="I.">I.</option>
      <option value="II.">II.</option>
      <option value="">Bez</option>
    </select>

    <div class="flex gap-2">
      <input id="filterMinVymera"
        type="number"
        placeholder="Min m²"
        class="w-1/2 px-2 py-1 text-sm border rounded" />
      <input id="filterMaxVymera"
        type="number"
        placeholder="Max m²"
        class="w-1/2 px-2 py-1 text-sm border rounded" />
    </div>
  </div>

  <!-- Statistiky -->
  <div class="p-4 border-b">
    <div class="font-semibold mb-2">Statistiky</div>
    <div class="text-sm text-slate-700 space-y-1">
      <div>Počet: <span id="statCount">–</span></div>
      <div>Výměra: <span id="statVymera">–</span> m²</div>
      <div>Oplocení: <span id="statOploceni">–</span> m</div>
      <div>Průměr: <span id="statAvg">–</span> m²</div>
    </div>
  </div>

</aside>


  <!-- MAP -->
  <main class="flex-1 relative">
    <div id="map"></div>
  </main>

</div>

<!-- ===================== -->
<!-- SCRIPTS -->
<!-- ===================== -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
/* =====================================================
   CONFIG
===================================================== */
const CONFIG = {
  STORAGE_KEY: 'arealy_v1',
  MAP_CENTER: [49.8, 15.5],
  MAP_ZOOM: 7
};

/* =====================================================
   STATUS BAR
===================================================== */
const StatusBar = {
  el: document.getElementById('statusBar'),

  set(text) {
    this.el.textContent = text;
  },

  setSaved() {
    this.set('Data uložena v LocalStorage');
  }
};

/* =====================================================
   STORE (LocalStorage)
===================================================== */
const Store = {
  load() {
    try {
      const raw = localStorage.getItem(CONFIG.STORAGE_KEY);
      return raw ? JSON.parse(raw) : [];
    } catch (e) {
      console.error('Chyba při načítání dat', e);
      return [];
    }
  },

  save(data) {
    localStorage.setItem(CONFIG.STORAGE_KEY, JSON.stringify(data));
    StatusBar.setSaved();
  }
};

/* =====================================================
   DATA MODEL
===================================================== */
function createAreal(data) {
  return {
    id: data.id || crypto.randomUUID(),
    nazev: data.nazev,
    okres: data.okres,
    typ: data.typ || '',
    kategorie: data.kategorie || '',
    vymera: Number(data.vymera) || 0,
    oploceni: Number(data.oploceni) || 0,
    lat: Number(data.lat),
    lon: Number(data.lon),
    pozn: data.pozn || '',
    created_at: data.created_at || new Date().toISOString(),
    updated_at: new Date().toISOString()
  };
}
<script>
/* =====================================================
   FILTERS
===================================================== */
const Filters = {
  state: {
    text: '',
    okres: '',
    kategorie: '',
    minVymera: null,
    maxVymera: null
  },

  init(data) {
    this.fillOkresy(data);

    document.getElementById('filterText')
      .addEventListener('input', e => {
        this.state.text = e.target.value.toLowerCase();
        App.refresh();
      });

    document.getElementById('filterOkres')
      .addEventListener('change', e => {
        this.state.okres = e.target.value;
        App.refresh();
      });

    document.getElementById('filterKategorie')
      .addEventListener('change', e => {
        this.state.kategorie = e.target.value;
        App.refresh();
      });

    document.getElementById('filterMinVymera')
      .addEventListener('input', e => {
        this.state.minVymera = e.target.value ? Number(e.target.value) : null;
        App.refresh();
      });

    document.getElementById('filterMaxVymera')
      .addEventListener('input', e => {
        this.state.maxVymera = e.target.value ? Number(e.target.value) : null;
        App.refresh();
      });
  },

  fillOkresy(data) {
    const select = document.getElementById('filterOkres');
    const okresy = [...new Set(data.map(a => a.okres))].sort();

    okresy.forEach(o => {
      const opt = document.createElement('option');
      opt.value = o;
      opt.textContent = o;
      select.appendChild(opt);
    });
  }
};

function applyFilters(data, f) {
  return data.filter(a =>
    (!f.text || a.nazev.toLowerCase().includes(f.text) || a.okres.toLowerCase().includes(f.text)) &&
    (!f.okres || a.okres === f.okres) &&
    (!f.kategorie || a.kategorie === f.kategorie) &&
    (!f.minVymera || a.vymera >= f.minVymera) &&
    (!f.maxVymera || a.vymera <= f.maxVymera)
  );
}
</script>
<script>
/* =====================================================
   STATS
===================================================== */
const Stats = {
  render(data) {
    const totalVymera = data.reduce((s,a)=>s+a.vymera,0);
    const totalOploceni = data.reduce((s,a)=>s+a.oploceni,0);

    document.getElementById('statCount').textContent = data.length;
    document.getElementById('statVymera').textContent = totalVymera;
    document.getElementById('statOploceni').textContent = totalOploceni;
    document.getElementById('statAvg').textContent =
      data.length ? Math.round(totalVymera / data.length) : 0;
  }
};
</script>

/* =====================================================
   MAP
===================================================== */
const MapApp = {
  map: null,
  markers: [],

  init() {
    this.map = L.map('map').setView(CONFIG.MAP_CENTER, CONFIG.MAP_ZOOM);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '© OpenStreetMap'
    }).addTo(this.map);
  },

  clear() {
    this.markers.forEach(m => this.map.removeLayer(m));
    this.markers = [];
  },

  render(arealy) {
    this.clear();

    arealy.forEach(a => {
      if (!a.lat || !a.lon) return;

      const marker = L.marker([a.lat, a.lon]).addTo(this.map);
      marker.bindPopup(this.popupContent(a));
      this.markers.push(marker);
    });

    StatusBar.set(`Zobrazeno ${arealy.length} areálů`);
  },

  popupContent(a) {
    return `
      <div class="text-sm">
        <div class="font-semibold">${a.nazev}</div>
        <div>Okres: ${a.okres}</div>
        <div>Výměra: ${a.vymera} m²</div>
        <div>Oplocení: ${a.oploceni} m</div>
        <a
          class="text-blue-600 underline mt-1 inline-block"
          target="_blank"
          href="https://www.google.com/maps?q=${a.lat},${a.lon}">
          Navigovat
        </a>
      </div>
    `;
  }
};

<script>
/* =====================================================
   APP CONTROLLER
===================================================== */
const App = {
  data: [],

  init() {
    MapApp.init();
    this.data = Store.load();

    if (this.data.length === 0) {
      this.data = [
        createAreal({
          nazev: 'VDJ Demo',
          okres: 'CB',
          kategorie: 'I.',
          vymera: 3300,
          oploceni: 290,
          lat: 49.305131,
          lon: 14.166126
        })
      ];
      Store.save(this.data);
    }

    Filters.init(this.data);
    this.refresh();
  },

  refresh() {
    const filtered = applyFilters(this.data, Filters.state);
    MapApp.render(filtered);
    Stats.render(filtered);
  }
};

document.addEventListener('DOMContentLoaded', () => App.init());
</script>


</body>
</html>

